{% extends 'layout.html' %}

{% load crispy_forms_tags %}

{% block content %}
<div class="item-entry">
	<div class="card">
		<div class="card-header">
			{% if object.main_image %}
			<img class="cojack-image" src="{{ object.main_image.url }}" alt="{{ object.name }}">
			{% endif %}
		</div>
		<div class="card-body">
			<h2>{{ object.name }}</h2>
			{% if user.is_authenticated and user.is_staff %}
			<p>by {{ object.publisher }} | {{ object.created_at }}</p>
			{% endif %}
			<h6>{{ object.description }}</h6>
			<p>${{ object.current_price }}</p>
			<div class="d-flex justify-content-between align-items-center">
				<div class="btn-group">
					<a class="mr-1" href="#"><button type="button" class="btn btn-sm btn-outline-secondary">Add to Cart</button></a>
					{% if user.is_authenticated and user.is_staff %}
					<a href="{% url 'product_edit' product.pk %}"><button type="button" class="btn btn-sm btn-success">Edit</button></a>
					<a class="ml-1" href="{% url 'product_delete' product.pk %}"><button type="button" class="btn btn-sm btn-danger">Delete</button></a>
					{% endif %}
				</div>
			</div>
			<p>Back to <a href="{% url 'product_list' %}">All Products</a>.</p>
		</div>
		<div class="card-footer bg-white">
			{% for comment in object.comments.all %}
			<div class="rounded bg-light border border-secondary mb-2">
				<div class="mx-3 my-2">
					<h6>Comment By <span class="font-weight-bold">{{ comment.publisher }}</span></h6>
					<p>{{ comment }}</p>
					{% if user.is_authenticated and user.is_staff %}
					<a href="{% url 'comment_detail' product.pk comment.pk %}"><button type="button" class="btn btn-sm btn-outline-secondary">View Details</button></a>
					<a href="{% url 'comment_edit' product.pk comment.pk %}"><button type="button" class="btn btn-sm btn-success">Edit</button></a>
					<a href="{% url 'comment_delete' product.pk comment.pk %}"><button type="button" class="btn btn-sm btn-danger">Delete</button></a>
					{% endif %}
				</div>
			</div>
			{% endfor %}
			<div>
				{% csrf_token %}
				{{ form|crispy }}
				{% if user.is_authenticated %}
				<a href="{% url 'comment_new' product.pk %}">Add Comment</a>
				{% endif %}
			</div>			
		</div>
	</div>
</div>
{% endblock content %}
